# MalwareAnalysis

<br>
<h3>Preparing a network</h3>

We need to create a VM sandbox enviroment. But before we do that we need to create an isolated network to protect the home computers if something goes wrong. I will be creating a guest network which purpose is to isolate from the LAN network and from each others. It will only have access to the internet.

In my case I am using VMware esxi 6.7 and will briefly explain that I have to create a virtual switch thats named GUESTNET, that I attached to the Port groups. No physical NIC attached. This switch will be attached as a Network adapter in my virtual firewall OpnSense.

Now that we have a virtual network for the guestnetwork we can configure it in the firewall. In my case when adding a new network adapter in vmware I had to reassign the interface in OpnSense since all the network adapters got renamed inside OpnSense, example the WAN interface vmx1 became vmx2 etc.

In OpnSense, go to Interface and Assignments, click on the plus sign and choose the interface you just created. You can compare the MAC address.

Once created you can now click on GUESTNET under interface and hit enable. Then change IPv4 configuration to "Static IPv4" and set a IPv4 address. Our case will be 192.168.4.1/24

Now we will setup a DHCP. Go to Services -> DHCPv4 -> [GUESTNET]. Check "Enable", fill in the range example 192.168.4.2 - 192.168.4.254, DNS servers will be 8.8.8.8, and gateway will be 192.168.4.1. Hit save.

We will create a firewall rule to block the GUESTNET to have any access. Go to Firewall -> Rules -> GUESTNET then hit the + sign. 

Block GUESTNET net to GUESTNET address, to isolate each client from themselves in the GUESTNET network and disable the ability to connect to the web interface for the firewall. Also block GUESTNET net to LAN net and all the extra networks you have in your firewall. I have a special case where my WAN net is another home network which I need to block to prevent anything from accessing outside the firewall. The firewall rules should look like the picture above.

